const assert = require("node:assert/strict");

const db = connect("mongodb://localhost/opcua");

(function testNoValue() {
    const result = db.data.findOne({ _id: "novalue" });

    print(EJSON.stringify(result));

    assert.equal(Object.keys(result.val).length, 0);

    assert.equal(Object.keys(result.ts).length, 0);

    assert.equal(result.updatedAt.toISOString(), "1969-12-31T23:59:59.000Z");
})();

(function testIntegration() {
    const result = db.data.findOne({ _id: "integration-tests" });

    print(EJSON.stringify(result));

    assert.equal(result.val.State, 0);

    assert.equal(result.val.slowNumberOfUpdates, -1);

    assert.equal(typeof result.val.AlternatingBoolean, "boolean");

    assert.ok(result.val.RandomUnsignedInt32 > 0, "RandomUnsignedInt32");

    const timeDiff =
        Date.parse(result.val.CurrentTime) - Date.parse(result.val.StartTime);
    assert.ok(timeDiff > 0, `timeDiff = ${timeDiff}`);

    const timestampDiff = Date.now() - result.ts.State;
    assert.ok(timestampDiff > 0, `timestampDiff = ${timestampDiff}`);

    assert.equal(result.val.ParameterSet.BaseTemperature, 10)

    assert.equal(result.val.ParameterSet.TargetTemperature, 80)
})();
